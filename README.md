# Age Verification - FHEVM

> Privacy-preserving age verification using Fully Homomorphic Encryption (FHEVM v0.9)

A decentralized application that allows users to verify their age (â‰¥18) without revealing their actual age to anyone. All computations happen on encrypted data using Zama's FHEVM technology.

---

## ğŸš€ å•†ä¸šæ„¿æ™¯ & å¸‚åœºæœºä¼š

### ğŸ’¡ æ ¸å¿ƒä»·å€¼ä¸»å¼ 

**é—®é¢˜**ï¼šå…¨çƒèŒƒå›´å†…ï¼Œå¹´é¾„éªŒè¯æ˜¯ä¸€ä¸ªä»·å€¼ **æ•°ä¸‡äº¿ç¾å…ƒ** çš„åˆè§„éœ€æ±‚ï¼Œä½†ç°æœ‰è§£å†³æ–¹æ¡ˆå­˜åœ¨ä¸¥é‡ç¼ºé™·ï¼š
- **ä¼ ç»Ÿ KYC**ï¼šéœ€è¦ä¸Šä¼ èº«ä»½è¯ã€æŠ¤ç…§ï¼Œç”¨æˆ·éšç§å®Œå…¨æš´éœ²ï¼Œæ•°æ®æ³„éœ²é£é™©æé«˜
- **ç¬¬ä¸‰æ–¹æœåŠ¡**ï¼šä¾èµ–ä¸­å¿ƒåŒ–æœºæ„ï¼Œæˆæœ¬é«˜ï¼ˆæ¯æ¬¡éªŒè¯ $0.5-$2ï¼‰ï¼Œå“åº”æ…¢ï¼Œä¸”å­˜åœ¨å•ç‚¹æ•…éšœ
- **ä¿¡ä»»é—®é¢˜**ï¼šç”¨æˆ·ä¸ä¿¡ä»»å¹³å°ä¼šå®‰å…¨å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œå¯¼è‡´ 60% çš„ç”¨æˆ·æµå¤±

**æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… **é›¶æ•°æ®æ³„éœ²**ï¼šç”¨æˆ·å¹´é¾„æ°¸è¿œåŠ å¯†ï¼Œå¹³å°æ— æ³•çœ‹åˆ°çœŸå®æ•°æ®
- âœ… **å³æ—¶éªŒè¯**ï¼šé“¾ä¸ŠéªŒè¯ä»…éœ€ 30 ç§’ï¼Œæ— éœ€ç­‰å¾…ç¬¬ä¸‰æ–¹å®¡æ ¸
- âœ… **ä½æˆæœ¬**ï¼šGas è´¹ä»… $0.01-0.05ï¼ˆSepoliaï¼‰ï¼Œæ¯”ä¼ ç»Ÿ KYC ä¾¿å®œ 50 å€
- âœ… **é€šç”¨æ ‡å‡†**ï¼šä¸€æ¬¡éªŒè¯ï¼Œå…¨ç½‘é€šç”¨ï¼Œå‡å°‘ç”¨æˆ·é‡å¤æ“ä½œ

---

### ğŸŒ ç›®æ ‡å¸‚åœºä¸è§„æ¨¡

#### 1. **æ¸¸æˆä¸ NFT å¸‚åœº** ğŸ®
- **å¸‚åœºè§„æ¨¡**ï¼šå…¨çƒæ¸¸æˆå¸‚åœº $180B+ï¼ŒåŒºå—é“¾æ¸¸æˆ $10B+ ä¸”å¿«é€Ÿå¢é•¿
- **ç—›ç‚¹**ï¼šESRBã€PEGI å¹´é¾„åˆ†çº§è¦æ±‚ï¼Œä½†ä¼ ç»Ÿ KYC å¯¼è‡´ç”¨æˆ·æµå¤±ä¸¥é‡
- **åº”ç”¨**ï¼š
  - 18+ æ¸¸æˆå¹´é¾„é—¨æ§›ï¼ˆå°„å‡»ã€èµŒåšç±»æ¸¸æˆï¼‰
  - NFT å¸‚åœºé™åˆ¶æˆäººå†…å®¹è®¿é—®
  - GameFi å¹³å°åˆè§„ï¼ˆé˜²æ­¢æœªæˆå¹´äººèµŒåšï¼‰
- **æ”¶å…¥æ¨¡å¼**ï¼šæ¯æ¬¡éªŒè¯æ”¶è´¹ $0.10ï¼Œæˆ–æŒ‰å¹³å°æœˆè®¢é˜… $500-5000

#### 2. **DeFi ä¸é‡‘èæœåŠ¡** ğŸ’°
- **å¸‚åœºè§„æ¨¡**ï¼šDeFi TVL $50B+ï¼Œä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ç”¨æˆ· 5 äº¿+
- **ç—›ç‚¹**ï¼šç›‘ç®¡è¦æ±‚ï¼ˆMiCAã€ç¾å›½è¯åˆ¸æ³•ï¼‰ï¼Œä½†ç”¨æˆ·æ‹’ç»æäº¤èº«ä»½è¯
- **åº”ç”¨**ï¼š
  - å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆDEXï¼‰å‡†å…¥éªŒè¯
  - å€Ÿè´·åè®®ï¼ˆAaveã€Compoundï¼‰åˆè§„
  - ä¿é™©å¹³å°å¹´é¾„é™åˆ¶
  - ç¨³å®šå¸å‘è¡Œå•†ï¼ˆUSDCã€USDTï¼‰KYC æ›¿ä»£æ–¹æ¡ˆ
- **æ”¶å…¥æ¨¡å¼**ï¼šå¹³å°é›†æˆè´¹ $10,000-50,000/å¹´ + æ¯æ¬¡éªŒè¯ $0.05

#### 3. **ç¤¾äº¤ä¸çº¦ä¼šå¹³å°** ğŸ­
- **å¸‚åœºè§„æ¨¡**ï¼šåœ¨çº¿çº¦ä¼šå¸‚åœº $10B+ï¼ŒWeb3 ç¤¾äº¤å¿«é€Ÿå´›èµ·ï¼ˆLens Protocolã€Farcasterï¼‰
- **ç—›ç‚¹**ï¼šä¿æŠ¤æœªæˆå¹´äººï¼Œä½†ä¼ ç»Ÿæ–¹æ¡ˆæˆæœ¬é«˜ã€ç”¨æˆ·åæ„Ÿ
- **åº”ç”¨**ï¼š
  - çº¦ä¼šåº”ç”¨å¹´é¾„éªŒè¯ï¼ˆTinderã€Bumbleï¼‰
  - Web3 ç¤¾äº¤å¹³å°æˆäººå†…å®¹è¿‡æ»¤
  - ç›´æ’­å¹³å°åˆè§„ï¼ˆTwitchã€OnlyFans æ›¿ä»£å“ï¼‰
- **æ”¶å…¥æ¨¡å¼**ï¼šè®¢é˜…åˆ¶ SaaS $1,000-10,000/æœˆ

#### 4. **ç”µå•†ä¸å†…å®¹å¹³å°** ğŸ›’
- **å¸‚åœºè§„æ¨¡**ï¼šç”µå•† $5.7T+ï¼Œæˆäººå†…å®¹ã€é…’ç²¾ã€çƒŸè‰ç­‰å—é™å•†å“å¸‚åœº $500B+
- **ç—›ç‚¹**ï¼šæ³•å¾‹è¦æ±‚å¹´é¾„éªŒè¯ï¼Œä½†ç”¨æˆ·ä¸æ„¿æä¾›èº«ä»½è¯
- **åº”ç”¨**ï¼š
  - é…’ç²¾ã€çƒŸè‰ç”µå•†å¹´é¾„é—¨æ§›
  - æˆäººå†…å®¹ç½‘ç«™ï¼ˆOnlyFansã€Patreonï¼‰
  - è¯å“ã€ä¿å¥å“åœ¨çº¿é”€å”®
  - è§†é¢‘å¹³å°ï¼ˆNetflixã€YouTubeï¼‰å®¶é•¿æ§åˆ¶
- **æ”¶å…¥æ¨¡å¼**ï¼šAPI è°ƒç”¨æŒ‰æ¬¡è®¡è´¹ $0.05-0.20/æ¬¡

---

### ğŸ’¸ å•†ä¸šæ¨¡å¼ï¼ˆå¤šå…ƒåŒ–æ”¶å…¥ï¼‰

#### **1. B2B SaaS è®¢é˜…** ğŸ¢
- **ç›®æ ‡å®¢æˆ·**ï¼šæ¸¸æˆå…¬å¸ã€DeFi åè®®ã€ç¤¾äº¤å¹³å°
- **å®šä»·**ï¼š
  - åˆåˆ›ç‰ˆï¼š$500/æœˆï¼ˆ10,000 æ¬¡éªŒè¯/æœˆï¼‰
  - ä¼ä¸šç‰ˆï¼š$5,000/æœˆï¼ˆ100,000 æ¬¡éªŒè¯/æœˆï¼‰
  - å®šåˆ¶ç‰ˆï¼šæŒ‰éœ€å®šä»·
- **ä»·å€¼**ï¼šä¸€ç«™å¼åˆè§„è§£å†³æ–¹æ¡ˆï¼Œæ— éœ€è‡ªå»º KYC å›¢é˜Ÿ

#### **2. API è°ƒç”¨æŒ‰æ¬¡è®¡è´¹** ğŸ“¡
- **ä»·æ ¼**ï¼š$0.05-0.20/æ¬¡éªŒè¯
- **ç›®æ ‡**ï¼šå¤§å‹å¹³å°ï¼ˆäº¤æ˜“æ‰€ã€ç¤¾äº¤ç½‘ç»œï¼‰
- **ä¼˜åŠ¿**ï¼šæˆæœ¬ä»…ä¸ºä¼ ç»Ÿ KYC çš„ 5-10%

#### **3. ç™½æ ‡è§£å†³æ–¹æ¡ˆ** ğŸ·ï¸
- **ä»·æ ¼**ï¼š$50,000-200,000 ä¸€æ¬¡æ€§è´¹ç”¨ + å¹´åº¦ç»´æŠ¤è´¹
- **ç›®æ ‡**ï¼šå¤§å‹ä¼ä¸šéœ€è¦ç§æœ‰åŒ–éƒ¨ç½²
- **äº¤ä»˜**ï¼šæºä»£ç  + æŠ€æœ¯æ”¯æŒ + å®šåˆ¶åŒ–å¼€å‘

#### **4. NFT å¾½ç« ä¸é“¾ä¸Šå‡­è¯** ğŸ–ï¸
- **åŠŸèƒ½**ï¼šéªŒè¯é€šè¿‡åé“¸é€  NFT å¾½ç« ï¼ˆSoulbound Tokenï¼‰
- **åº”ç”¨**ï¼šå…¶ä»–å¹³å°å¯æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦æŒæœ‰å¹´é¾„éªŒè¯ NFT
- **æ”¶å…¥**ï¼šé“¸é€ è´¹ $1-5/æ¬¡ï¼ŒäºŒæ¬¡éªŒè¯æŸ¥è¯¢è´¹ $0.01/æ¬¡

#### **5. æ•°æ®æ´å¯Ÿï¼ˆåŒ¿åèšåˆï¼‰** ğŸ“Š
- **äº§å“**ï¼šæä¾›è¡Œä¸šå¹´é¾„åˆ†å¸ƒæŠ¥å‘Šï¼ˆå¦‚"åŒºå—é“¾æ¸¸æˆç”¨æˆ·å¹³å‡å¹´é¾„"ï¼‰
- **éšç§ä¿è¯**ï¼šä»…æä¾›èšåˆç»Ÿè®¡ï¼Œä¸æ³„éœ²ä¸ªäººæ•°æ®
- **æ”¶å…¥**ï¼šæŠ¥å‘Šè®¢é˜… $1,000-10,000/ä»½

---

### ğŸ¯ ç«äº‰ä¼˜åŠ¿

| ç»´åº¦ | ä¼ ç»Ÿ KYC | ç«å“ï¼ˆå¦‚ Civicã€Onfidoï¼‰ | **æˆ‘ä»¬ (FHEVM)** |
|------|---------|------------------------|-----------------|
| **éšç§ä¿æŠ¤** | âŒ éœ€ä¸Šä¼ èº«ä»½è¯ | âš ï¸ ç¬¬ä¸‰æ–¹æŒæœ‰æ•°æ® | âœ… æ•°æ®æ°¸è¿œåŠ å¯† |
| **æˆæœ¬** | $1-2/æ¬¡ | $0.5-1/æ¬¡ | **$0.01-0.05/æ¬¡** |
| **é€Ÿåº¦** | æ•°å°æ—¶-æ•°å¤© | 1-5 åˆ†é’Ÿ | **30-60 ç§’** |
| **å¯é‡ç”¨æ€§** | âŒ æ¯ä¸ªå¹³å°é‡æ–°éªŒè¯ | âš ï¸ éƒ¨åˆ†æ”¯æŒ | âœ… ä¸€æ¬¡éªŒè¯å…¨ç½‘é€šç”¨ |
| **ç›‘ç®¡å‹å¥½** | âœ… | âœ… | âœ… |
| **å»ä¸­å¿ƒåŒ–** | âŒ | âŒ | âœ… |

---

### ğŸ“ˆ å¢é•¿è·¯çº¿å›¾

#### **Q1 2025ï¼šMVP ä¸ç§å­å®¢æˆ·** ğŸŒ±
- âœ… å®Œæˆ Sepolia æµ‹è¯•ç½‘éƒ¨ç½²
- âœ… è·å¾— 3-5 ä¸ªç§å­å®¢æˆ·ï¼ˆå°å‹ GameFi é¡¹ç›®ï¼‰
- ç›®æ ‡ï¼š1,000 æ¬¡éªŒè¯/æœˆ

#### **Q2 2025ï¼šä¸»ç½‘ä¸Šçº¿ä¸è§„æ¨¡åŒ–** ğŸš€
- [ ] éƒ¨ç½²åˆ°ä»¥å¤ªåŠä¸»ç½‘ + L2ï¼ˆArbitrumã€Optimismï¼‰
- [ ] é›†æˆ 5-10 ä¸ªä¸­å‹å¹³å°ï¼ˆDEXã€ç¤¾äº¤åº”ç”¨ï¼‰
- [ ] æ¨å‡º API ä¸ SDK
- ç›®æ ‡ï¼š50,000 æ¬¡éªŒè¯/æœˆï¼Œæ”¶å…¥ $5,000/æœˆ

#### **Q3 2025ï¼šå¤šé“¾æ‰©å±•** ğŸŒ
- [ ] æ”¯æŒ Polygonã€BNB Chainã€Avalanche
- [ ] æ¨å‡ºç™½æ ‡è§£å†³æ–¹æ¡ˆ
- [ ] ç­¾çº¦ 1-2 ä¸ªå¤§å‹å®¢æˆ·ï¼ˆæœˆæ´» 100 ä¸‡+ï¼‰
- ç›®æ ‡ï¼š500,000 æ¬¡éªŒè¯/æœˆï¼Œæ”¶å…¥ $50,000/æœˆ

#### **Q4 2025ï¼šç”Ÿæ€ç³»ç»Ÿä¸æ ‡å‡†åŒ–** ğŸ†
- [ ] æ¨å‡º NFT å¾½ç« ç³»ç»Ÿï¼ˆè·¨å¹³å°è®¤è¯ï¼‰
- [ ] ä¸ Web3 èº«ä»½åè®®é›†æˆï¼ˆENSã€Lensã€Worldcoinï¼‰
- [ ] ç”³è¯·æˆä¸º W3Cã€EIP æ ‡å‡†ä¸€éƒ¨åˆ†
- ç›®æ ‡ï¼š200 ä¸‡æ¬¡éªŒè¯/æœˆï¼Œæ”¶å…¥ $200,000/æœˆ

---

### ğŸŒŸ é•¿æœŸæ„¿æ™¯

1. **æˆä¸º Web3 èº«ä»½åŸºç¡€è®¾æ–½**ï¼šå¦‚åŒ OAuth ä¹‹äº Web2ï¼Œæˆ‘ä»¬è¦æˆä¸º Web3 å¹´é¾„éªŒè¯çš„æ ‡å‡†åè®®
2. **æ‰©å±•åˆ°å…¶ä»–éšç§éªŒè¯**ï¼šä¿¡ç”¨è¯„åˆ†ã€æ”¶å…¥éªŒè¯ã€æ•™è‚²èƒŒæ™¯ï¼ˆå‡ä¿æŒæ•°æ®åŠ å¯†ï¼‰
3. **ç›‘ç®¡åˆä½œ**ï¼šä¸æ”¿åºœã€è¡Œä¸šåä¼šåˆä½œï¼Œæ¨åŠ¨éšç§å‹å¥½å‹æ³•è§„
4. **å…¨çƒåŒ–**ï¼šæ”¯æŒ GDPRï¼ˆæ¬§æ´²ï¼‰ã€CCPAï¼ˆåŠ å·ï¼‰ã€COPPAï¼ˆç¾å›½æœªæˆå¹´ä¿æŠ¤æ³•ï¼‰ç­‰å„åœ°æ³•è§„

**æœ€ç»ˆç›®æ ‡**ï¼šè®©éšç§ä¿æŠ¤æˆä¸ºé»˜è®¤é€‰é¡¹ï¼Œè€Œä¸æ˜¯å¦¥åã€‚

---

## ğŸŒŸ æŠ€æœ¯ç‰¹æ€§

- **ğŸ”’ Complete Privacy**: Your age is encrypted on your device and never exposed in plain text
- **â›“ï¸ On-Chain Verification**: Smart contract verifies age â‰¥ 18 on encrypted data
- **ğŸ” User-Controlled Decryption**: Only you can decrypt the verification result using your wallet signature
- **âœ¨ Beautiful UI**: Modern, responsive interface with real-time feedback
- **ğŸš€ Zero-Knowledge Proofs**: Cryptographic proofs ensure data integrity

## ğŸ—ï¸ Architecture

### Smart Contract (FHEVM v0.9)
- **Contract**: `AgeVerification.sol`
- **Network**: Sepolia Testnet
- **Address**: `0x798C8Fcf112d37F98a64ffe1a8520C5230478838`
- **Operations**:
  - `submitAge()`: Accept encrypted age and verify if â‰¥ 18
  - `getMyResult()`: Return encrypted verification result
  - Uses `FHE.ge()` for encrypted comparison
  - Implements dual permission model (`FHE.allowThis()` + `FHE.allow()`)

### Frontend
- **Framework**: Next.js 15 + React 19
- **Styling**: Tailwind CSS
- **Wallet**: RainbowKit + Wagmi v2
- **FHEVM SDK**: Zama Relayer SDK 0.3.0-5 (CDN)
- **Blockchain**: Ethers.js v6

## ğŸš€ Quick Start

### Prerequisites
- Node.js 18+
- pnpm
- MetaMask or compatible Web3 wallet
- Sepolia testnet ETH ([Get from faucet](https://sepoliafaucet.com/))

### Installation

```bash
# Clone the repository
git clone <repository-url>
cd age-verification-fhevm

# Install dependencies
pnpm install

# Copy environment file
cp packages/hardhat/.env.example packages/hardhat/.env
```

### Development

```bash
# Start the development server
pnpm dev

# Open http://localhost:3000
```

The frontend will be available at `http://localhost:3000`

### Contract Deployment (Optional)

The contract is already deployed to Sepolia. If you need to redeploy:

```bash
# Compile contracts
cd packages/hardhat
pnpm compile

# Deploy to Sepolia
pnpm exec hardhat deploy --network sepolia

# Update CONTRACT_ADDRESS in packages/nextjs-showcase/app/verify/page.tsx
```

## ğŸ“– How It Works

### 1. User Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Enter Age   â”‚â”€â”€â”€â”€â”€>â”‚ Encrypt      â”‚â”€â”€â”€â”€â”€>â”‚ Submit to   â”‚
â”‚ (plaintext) â”‚      â”‚ (FHEVM)      â”‚      â”‚ Contract    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ See Result  â”‚<â”€â”€â”€â”€â”€â”‚ Decrypt      â”‚<â”€â”€â”€â”€â”€â”‚ Verify      â”‚
â”‚ (1 or 0)    â”‚      â”‚ (userDecrypt)â”‚      â”‚ age >= 18   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Encryption Process

1. **Input**: User enters age (e.g., 25)
2. **Encrypt**: FHEVM SDK encrypts the value using `createEncryptedInput()`
3. **Proof**: Zero-knowledge proof is generated to verify encryption validity
4. **Submit**: Encrypted data (`handle`) + proof sent to smart contract

### 3. On-Chain Verification

```solidity
// Smart contract (simplified)
euint32 age = FHE.fromExternal(encryptedAge, proof);
ebool isAdult = FHE.ge(age, minimumAge); // age >= 18
euint32 result = FHE.select(isAdult, one, zero); // 1 or 0

// Grant permissions
FHE.allowThis(result);         // Contract can return handle
FHE.allow(result, msg.sender); // User can decrypt
```

### 4. Decryption Process

1. **Retrieve**: Get encrypted result handle from contract
2. **Generate Keys**: Create temporary keypair for decryption
3. **Sign**: User signs EIP-712 message with wallet
4. **Decrypt**: Call `userDecrypt()` with signature to get plaintext result
5. **Display**: Show 1 (Pass) or 0 (Fail)

## ğŸ”’ Privacy & Security

### What's Encrypted?
- User's actual age (never exposed)
- Intermediate computation results
- Final verification result (until user decrypts)

### What's Public?
- Contract address
- Transaction hash
- User's wallet address
- Encrypted data handles (meaningless without decryption key)

### Security Features
- **No Server Decryption**: All decryption happens client-side
- **User-Controlled**: Only the user can decrypt their result
- **Zero-Knowledge Proofs**: Ensures encrypted data is valid
- **Permission System**: Dual-layer access control
- **Threshold Network**: Zama's decentralized KMS

## ğŸ› ï¸ Technical Stack

### Smart Contracts
- Solidity 0.8.24
- FHEVM v0.9.1 (`@fhevm/solidity`)
- Hardhat + hardhat-deploy

### Frontend
- Next.js 15.0.0
- React 19.0.0
- RainbowKit 2.0.0
- Wagmi 2.0.0
- Ethers.js 6.9.0
- Tailwind CSS 3.4.0

### FHEVM Configuration
```javascript
{
  chainId: 11155111, // Sepolia
  aclContractAddress: '0xf0Ffdc93b7E186bC2f8CB3dAA75D86d1930A433D',
  kmsContractAddress: '0xbE0E383937d564D7FF0BC3b46c51f0bF8d5C311A',
  inputVerifierContractAddress: '0xBBC1fFCdc7C316aAAd72E807D9b0272BE8F84DA0',
  verifyingContractAddressDecryption: '0x5D8BD78e2ea6bbE41f26dFe9fdaEAa349e077478',
  verifyingContractAddressInputVerification: '0x483b9dE06E4E4C7D35CCf5837A1668487406D955',
  gatewayChainId: 10901,
  relayerUrl: 'https://relayer.testnet.zama.org',
}
```

## ğŸ“¸ Screenshots

### Landing Page
Clean introduction explaining the verification process and privacy guarantees.

### Verification Page
1. Connect wallet (RainbowKit)
2. Input age and submit
3. Wait for transaction confirmation
4. 10-second countdown for permission sync
5. Decrypt result with wallet signature
6. See Pass (âœ…) or Fail (âŒ)

## ğŸ› Troubleshooting

### "FHEVM initialization failed"
- Ensure you're using a supported wallet (MetaMask recommended)
- Try incognito mode to avoid multi-wallet conflicts
- Check browser console for detailed errors

### "User decrypt failed: HTTP 500"
- Wait for the full 10-second countdown before decrypting
- Permission sync can take 30-60 seconds
- If it fails, click decrypt again (auto-retry implemented)

### "No submission found"
- Ensure your wallet is connected with the same address that submitted
- Check transaction was confirmed on [Sepolia Etherscan](https://sepolia.etherscan.io/)

### Decryption takes too long
- Normal decryption time: 30-60 seconds
- Network congestion can extend this to 2-3 minutes
- Be patient and don't refresh the page

## ğŸ”— Links

- **Deployed Contract**: [0x798C8Fcf112d37F98a64ffe1a8520C5230478838](https://sepolia.etherscan.io/address/0x798C8Fcf112d37F98a64ffe1a8520C5230478838)
- **Zama Docs**: https://docs.zama.org/fhevm
- **Sepolia Faucet**: https://sepoliafaucet.com/
- **FHEVM Testnet**: https://docs.zama.org/fhevm/testnet

## ğŸ“‹ Project Structure

```
age-verification-fhevm/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ hardhat/                 # Smart contracts
â”‚   â”‚   â”œâ”€â”€ contracts/
â”‚   â”‚   â”‚   â””â”€â”€ AgeVerification.sol
â”‚   â”‚   â”œâ”€â”€ deploy/
â”‚   â”‚   â”‚   â””â”€â”€ 01_deploy_age_verification.ts
â”‚   â”‚   â””â”€â”€ hardhat.config.ts
â”‚   â”‚
â”‚   â””â”€â”€ nextjs-showcase/         # Frontend
â”‚       â”œâ”€â”€ app/
â”‚       â”‚   â”œâ”€â”€ layout.tsx       # Load FHEVM SDK
â”‚       â”‚   â”œâ”€â”€ page.tsx         # Landing page
â”‚       â”‚   â””â”€â”€ verify/
â”‚       â”‚       â””â”€â”€ page.tsx     # Main verification page
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ ClientProviders.tsx
â”‚       â”‚   â””â”€â”€ Providers.tsx    # RainbowKit setup
â”‚       â”œâ”€â”€ utils/
â”‚       â”‚   â””â”€â”€ wallet.ts        # Provider getter
â”‚       â”œâ”€â”€ next.config.js       # CORS + Webpack config
â”‚       â””â”€â”€ vercel.json          # Deployment config
â”‚
â”œâ”€â”€ pnpm-workspace.yaml
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸ¯ Core Development Principles

This project follows the **WINNING_FORMULA** for FHEVM development:

1. **Grand Narrative**: Privacy-preserving age verification for regulatory compliance
2. **Exquisite UI**: Clean, modern interface with clear user feedback
3. **Minimalist Backend**: Contract only computes, never decrypts (uses `userDecrypt`)
4. **Core Demo**: Single-button interaction focused on one key feature

## ğŸš¦ Performance Notes

- **Contract Deployment**: ~750k gas (~$0.05 on Sepolia)
- **Age Submission**: ~300-500k gas (~$0.03 on Sepolia)
- **Encryption Time**: < 1 second
- **Transaction Confirmation**: 5-15 seconds
- **Permission Sync**: 10 seconds (forced wait)
- **Decryption Time**: 30-60 seconds (relayer processing)

## ğŸ”® Future Enhancements

- [ ] Support for multiple age thresholds (21+, 16+, etc.)
- [ ] Batch verification for multiple users
- [ ] NFT badge minting for verified users
- [ ] Integration with DeFi protocols requiring age verification
- [ ] Mobile wallet support (WalletConnect)
- [ ] Mainnet deployment

## ğŸ“„ License

MIT

---

**Built with â¤ï¸ using [Zama FHEVM](https://www.zama.ai/) | Powered by Fully Homomorphic Encryption**

---

## ğŸ‘¨â€ğŸ’» Developer Notes

### Key Implementation Details

1. **SDK Version**: Must use 0.3.0-5 for FHEVM v0.9 compatibility
2. **initSDK()**: Must call before `createInstance()`
3. **Comparison API**: Use `FHE.ge()` not `FHE.gte()`
4. **Permission Model**: Always call both `FHE.allowThis()` and `FHE.allow()`
5. **Type Casting**: Use explicit `uint32()` conversion for `FHE.asEuint32()`
6. **CORS Headers**: Must set `credentialless` not `require-corp`
7. **Wait Time**: Enforce 10-second countdown before allowing decryption
8. **Auto-Retry**: Implement retry logic for 500 errors (permission sync)

### Environment Variables

**Backend** (`packages/hardhat/.env`):
```env
PRIVATE_KEY=0x...
ALCHEMY_API_KEY=...
RPC_URL=https://eth-sepolia.g.alchemy.com/v2/...
```

**Frontend** (hardcoded in page.tsx):
```typescript
const CONTRACT_ADDRESS = '0x798C8Fcf112d37F98a64ffe1a8520C5230478838';
```

### Testing Checklist

- [ ] Wallet connects successfully
- [ ] FHEVM initializes without errors
- [ ] Can submit age 18+ (should return 1)
- [ ] Can submit age < 18 (should return 0)
- [ ] 10-second countdown works
- [ ] Decryption completes within 60 seconds
- [ ] Auto-retry works on 500 errors
- [ ] UI displays correct Pass/Fail result
- [ ] Can verify multiple times

---

**Need Help?** Check the WINNING_FORMULA.md guide or [open an issue](https://github.com/yourusername/age-verification-fhevm/issues).

